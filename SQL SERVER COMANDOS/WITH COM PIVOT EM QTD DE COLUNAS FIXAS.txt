WITH TABELA AS 
(
SELECT CODCOLIGADA, RA,
CASE
	WHEN CODOCORRENCIAGRUPO = 2 THEN 'ALERTA'
	WHEN ((CODOCORRENCIAGRUPO = 4 AND CODOCORRENCIATIPO = 23)
		OR (CODOCORRENCIAGRUPO = 6 AND CODOCORRENCIATIPO = 26)
		OR (CODOCORRENCIAGRUPO = 7 AND CODOCORRENCIATIPO = 30)
		OR (CODOCORRENCIAGRUPO = 15 AND CODOCORRENCIATIPO = 24)
		OR (CODOCORRENCIAGRUPO = 5 AND CODOCORRENCIATIPO = 1)) THEN 'OCORRENCIA'
END AS TIPO
,COUNT(RA) AS QTD
FROM SOCORRENCIAALUNO
WHERE CODCOLIGADA = 1 AND 
CODOCORRENCIAGRUPO = 2
OR ((CODOCORRENCIAGRUPO = 4 AND CODOCORRENCIATIPO = 23)
 OR (CODOCORRENCIAGRUPO = 6 AND CODOCORRENCIATIPO = 26)
 OR (CODOCORRENCIAGRUPO = 7 AND CODOCORRENCIATIPO = 30)
 OR (CODOCORRENCIAGRUPO = 15 AND CODOCORRENCIATIPO = 24)
 OR (CODOCORRENCIAGRUPO = 5 AND CODOCORRENCIATIPO = 1))
GROUP BY CODCOLIGADA, RA, 
CASE
	WHEN CODOCORRENCIAGRUPO = 2 THEN 'ALERTA'
	WHEN ((CODOCORRENCIAGRUPO = 4 AND CODOCORRENCIATIPO = 23)
		OR (CODOCORRENCIAGRUPO = 6 AND CODOCORRENCIATIPO = 26)
		OR (CODOCORRENCIAGRUPO = 7 AND CODOCORRENCIATIPO = 30)
		OR (CODOCORRENCIAGRUPO = 15 AND CODOCORRENCIATIPO = 24)
		OR (CODOCORRENCIAGRUPO = 5 AND CODOCORRENCIATIPO = 1)) THEN 'OCORRENCIA'
END
)

SELECT CODCOLIGADA, RA
,[ALERTA] AS ALERTA
,[OCORRENCIA] AS OCORRENCIA
FROM TABELA PIVOT (MAX(QTD) FOR TIPO IN ([ALERTA], [OCORRENCIA]))P 
